<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docentes - Electromec√°nica</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='electromecanica/css/styles.css') }}">
</head>

<body>
    <div class="header-container3">
        <h1>Lista de Docentes - Electromec√°nica</h1>
        <div class="botones-container">
            <button onclick="window.location.href='/electromecanica/electromecanica_index';">Volver</button>
            <button onclick="toggleSearchBar()">üîç Buscar</button>
        </div>
    </div>
    <!-- üîπ Barra de b√∫squeda fija arriba -->
    <div id="searchBar" class="search-bar hide">
        <input type="text" id="searchInput" placeholder="üîç Buscar...">
        <button onclick="searchText()">Buscar</button>
        <button onclick="prevMatch()">‚¨Ö Anterior</button>
        <button onclick="nextMatch()">Siguiente ‚û°</button>
        <button onclick="toggleSearchBar()">‚ùå Cerrar</button>
        <p id="matchCount" style="margin-left: 10px"></p>
    </div>
    <table id="docentesTable">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Profesion</th>
                <th>Adscripci√≥n</th>
                <th>Fecha de ingreso</th>
                <th>Tiempo determinado</th>
                <th>Periodo actual</th>
                <th>Horas A</th>
                <th>Horas B</th>
                <th>Total de Horas</th>
                <th>Asignaci√≥n de Horas Frente a Grupo</th>
                <th>Asiganci√≥n de Horas de Descarga para Apoyo a la Docencia</th>
                <th>Cargo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for profesor in profesores %}
            <tr>
                <td>{{ profesor['nombre'] }}</td>
                <td>{{ profesor['profesion'] }}</td>
                <td>{{ profesor['adscripcion'] }}</td>
                <td>{{ profesor['fecha_ingreso'] }}</td>
                <td>{{ profesor['tiempo_indeterminado'] }}</td>
                <td>{{ profesor['periodo_actual'] }}</td>
                <td>{{ profesor['horas_a'] }}</td>
                <td>{{ profesor['horas_b'] }}</td>
                <td>{{ profesor['total_horas'] }}</td>
                <td>
                    <table class="inner-table">
                        <thead>
                            <th>Carrera</th>
                            <th>Apoyo a la Docencia</th>
                            <th>Grupo</th>
                            <th>Horas</th>
                            <th>Lunes</th>
                            <th>Martes</th>
                            <th>Mi√©rcoles</th>
                            <th>Jueves</th>
                            <th>Viernes</th>
                            <th>S√°bado</th>
                        </thead>
                        {% for i in range(1, 9) %}
                        <tr>
                            <td>{{ profesor['carrera' ~ i] }}</td>
                            <td class="form-group">{{ profesor['asignatura' ~ i] }}</td>
                            <td>{{ profesor['grupo' ~ i] }} {{ profesor['distintivo' ~ i] }}</td>
                            <td class="form-group">{{ profesor['horas' ~ i] }}</td>
                            <td>{{ profesor['hora_inicio' ~ i ~ '1'] }} {{ profesor['hora_fin' ~ i ~ '1'] }}</td>
                            <td>{{ profesor['hora_inicio' ~ i ~ '2'] }} {{ profesor['hora_fin' ~ i ~ '2'] }}</td>
                            <td>{{ profesor['hora_inicio' ~ i ~ '3'] }} {{ profesor['hora_fin' ~ i ~ '3'] }}</td>
                            <td>{{ profesor['hora_inicio' ~ i ~ '4'] }} {{ profesor['hora_fin' ~ i ~ '4'] }}</td>
                            <td>{{ profesor['hora_inicio' ~ i ~ '5'] }} {{ profesor['hora_fin' ~ i ~ '5'] }}</td>
                            <td>{{ profesor['hora_inicio' ~ i ~ '6'] }} {{ profesor['hora_fin' ~ i ~ '6'] }}</td>
                        </tr>
                        {% endfor %}
                        <tr>
                            <td></td>
                            <td>Total: </td>
                            <td>{{ profesor['total_horas_grupo'] }}</td>
                        </tr>
                    </table>
                </td>
                <td>
                    <table class="inner-table">
                        <thead>
                            <th>Carrera</th>
                            <th>Asignatura</th>
                            <th>Grupo</th>
                            <th>Horas</th>
                            <th>Lunes</th>
                            <th>Martes</th>
                            <th>Mi√©rcoles</th>
                            <th>Jueves</th>
                            <th>Viernes</th>
                            <th>S√°bado</th>
                        </thead>
                        {% for i in range(1, 9) %}
                        <tr>
                            <td>{{ profesor['carreraE' ~ i] }}</td>
                            <td class="form-groupE">{{ profesor['asignaturaE' ~ i] }}</td>
                            <td>{{ profesor['grupoE' ~ i] }}</td>
                            <td class="form-groupE">{{ profesor['horasE' ~ i] }}</td>
                            <td>{{ profesor['hora_inicioE' ~ i ~ '1'] }} {{ profesor['hora_finE' ~ i ~ '1'] }}</td>
                            <td>{{ profesor['hora_inicioE' ~ i ~ '2'] }} {{ profesor['hora_finE' ~ i ~ '2'] }}</td>
                            <td>{{ profesor['hora_inicioE' ~ i ~ '3'] }} {{ profesor['hora_finE' ~ i ~ '3'] }}</td>
                            <td>{{ profesor['hora_inicioE' ~ i ~ '4'] }} {{ profesor['hora_finE' ~ i ~ '4'] }}</td>
                            <td>{{ profesor['hora_inicioE' ~ i ~ '5'] }} {{ profesor['hora_finE' ~ i ~ '5'] }}</td>
                            <td>{{ profesor['hora_inicioE' ~ i ~ '6'] }} {{ profesor['hora_finE' ~ i ~ '6'] }}</td>
                        </tr>
                        {% endfor %}
                        <tr>
                            <td></td>
                            <td>Total: </td>
                            <td>{{ profesor['total_horasE_grupo'] }}</td>
                        </tr>
                    </table>
                </td>
                <td>
                    <table class="inner-table">
                        <thead>
                            <th>Carrera</th>
                            <th>Cargo</th>
                            <th>Vigencia</th>
                            <th>Horas</th>
                            <th>Lunes</th>
                            <th>Martes</th>
                            <th>Mi√©rcoles</th>
                            <th>Jueves</th>
                            <th>Viernes</th>
                            <th>S√°bado</th>
                        </thead>
                        <tr>
                            <td>{{ profesor['carreraC'] }}</td>
                            <td>{{ profesor['cargo'] }}</td>
                            <td>{{ profesor['vigenciaCargo'] }}</td>
                            <td>{{ profesor['horasC'] }}</td>
                            <td>{{ profesor['hora_inicioC11'] }} {{ profesor['hora_finC11'] }}</td>
                            <td>{{ profesor['hora_inicioC12'] }} {{ profesor['hora_finC12'] }}</td>
                            <td>{{ profesor['hora_inicioC13'] }} {{ profesor['hora_finC13'] }}</td>
                            <td>{{ profesor['hora_inicioC14'] }} {{ profesor['hora_finC14'] }}</td>
                            <td>{{ profesor['hora_inicioC15'] }} {{ profesor['hora_finC15'] }}</td>
                            <td>{{ profesor['hora_inicioC16'] }} {{ profesor['hora_finC16'] }}</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Total: </td>
                            <td>{{ profesor['horasC'] }}</td>
                        </tr>
                    </table>
                </td>
                <td>
                    <button onclick="deleteProfesor(`{{ profesor['_id'] }}`)">Eliminar</button>
                    <button data-url="/electromecanica/electromecanica_profesores/edit/{{ profesor._id }}">Editar</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        let matches = [];
        let currentIndex = -1;

        // Mostrar/Ocultar la barra de b√∫squeda
        function toggleSearchBar() {
            let searchBar = document.getElementById("searchBar");
            searchBar.classList.toggle("hide");
            if (!searchBar.classList.contains("hide")) {
                document.getElementById("searchInput").focus();
            }
        }

        function searchText() {
            let text = document.getElementById("searchInput").value.trim();
            if (text === "") return;

            clearHighlights();
            let regex = new RegExp(text, "gi");

            matches = [];
            currentIndex = -1;

            document.querySelectorAll("#docentesTable tbody td").forEach(td => {
                let childNodes = Array.from(td.childNodes);
                childNodes.forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) { // üü¢ Solo modificar nodos de texto
                        let originalText = node.textContent;
                        let newHTML = originalText.replace(regex, match => {
                            matches.push(td);
                            return `<mark>${match}</mark>`;
                        });

                        let tempDiv = document.createElement("div");
                        tempDiv.innerHTML = newHTML;
                        node.replaceWith(...tempDiv.childNodes);
                    }
                });
            });

            if (matches.length > 0) {
                currentIndex = 0;
                updateMatchInfo();
                scrollToMatch();
            } else {
                document.getElementById("matchCount").textContent = "‚ö† No se encontraron coincidencias.";
            }

            restoreEditButtonEvents(); // üü¢ Restaurar eventos de botones despu√©s de la b√∫squeda
        }

        // Restaurar eventos de los botones despu√©s de la b√∫squeda
        function restoreEditButtonEvents() {
            document.querySelectorAll('button[data-url]').forEach(function(button) {
                button.addEventListener('click', function() {
                    var url = this.getAttribute('data-url');
                    window.location.href = url;
                });
            });
        }

        function clearHighlights() {
            document.querySelectorAll("mark").forEach(mark => {
                let parent = mark.parentNode;
                parent.replaceChild(document.createTextNode(mark.textContent), mark);
            });
            document.getElementById("matchCount").textContent = "";
        }

        function updateMatchInfo() {
            document.getElementById("matchCount").textContent = `Coincidencia ${currentIndex + 1} de ${matches.length}`;
        }

        function scrollToMatch() {
            if (matches.length > 0) {
                matches[currentIndex].scrollIntoView({ behavior: "smooth", block: "center" });
            }
        }

        function nextMatch() {
            if (matches.length > 0 && currentIndex < matches.length - 1) {
                currentIndex++;
                updateMatchInfo();
                scrollToMatch();
            }
        }

        function prevMatch() {
            if (matches.length > 0 && currentIndex > 0) {
                currentIndex--;
                updateMatchInfo();
                scrollToMatch();
            }
        }

        // Inicializar eventos de los botones en la carga inicial
        document.addEventListener('DOMContentLoaded', function() {
            restoreEditButtonEvents(); // üü¢ Restaurar eventos al cargar la p√°gina

            document.querySelectorAll('.delete-button').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const type = this.getAttribute('data-type');

                    let endpoint = "";
                    if (type === "profesores") {
                        endpoint = "/electromecanica/electromecanica_profesores/" + id;
                    }

                    fetch(endpoint, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.msg);
                        location.reload();
                    });
                });
            });
        });
    </script>
    
    <script src="{{ url_for('static', filename='electromecanica/js/app.js') }}"></script>
    </body>
    </html>